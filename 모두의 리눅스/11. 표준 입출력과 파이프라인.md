# 11. 표준 입출력과 파이프라인

명령어를 조합하기 전에 먼저 명령어 간에 실행 결과를 주고받는 원리를 이해해야 한다. 

표준 입출력이라는 용어를 알아보겠다. 

리눅스에서는 `cat` 명령어를 실행하면 자동으로 표준 입출력 채널이 열린다. 여기서 채널은 데이터가 흐르는 길이라고 생각하면 된다. 

표준 입출력 채널은 세가지가 있다. 이 3개의 채널을 합쳐서 표준 입출력이라고 한다. 

표준 입력(stdin) : 프로그램에 데이터를 입력하는 채널.

표준 출력(stdout) : 프로그램의 실행 결과가 출력되는 채널

표준 에러 출력(stderr) : 에러 메시지가 출력되는 채널

리눅스 명령어는 표준 입출력이 실제 어디에 연결되었는지 신경 쓰지 않는다. 명령어의 입장에서는 단순히 표준 입력을 읽어서 결과를 표준 출력으로 출력할 뿐이다. 표준 입력은 키보드로 입력될 수도 있고 파일이 될 수도 있다. 표준 출력은 모니터, 프린터 혹은 파일이 될 수도 있다. 

## 리다이렉션

표준 입출력을 어디로 연결할지 변경하는 것을 리다이렉션이라고 한다. 

### 표준 입력의 리다이렉션

`cat` 은 표준 입력으로 입력한 내용을 읽어서 그대로 표준 출력에 출력하는 명령어이다.

표준 입력은 보통 키보드 입력이므로 키보드 입력을 기다렸다가 그대로 출력한다. 

**입력 리다이렉션** : 키보드 대신에 파일을 표준 입력으로 연결해보겠다. 기호로 `<` 를 사용한다. 

`cat < /etc/crontab` : /etc/crontab 파일의 내용이 표준 입력으로 cat 명령어에 전달된다. 그러면 cat 명령어는 그 내용을 그대로 표준 출력에 출력한다. 

`cat /etc/crontab` vs `cat < /etc/crontab`

두 방식의 출력 결과는 같지만, 내부적인 차이점은 명확히 이해해야 한다. 

리다이렉션을 사용한 경우는 ‘표준 입력을 읽어서 표준 출력에 그대로 출력한다’ 는 cat 명령어의 기본 동작에 충실한 방식이다. 

한편 파일을 실행 인자로 지정하는 방식은 사용자의 편의를 위해 cat 명령어가 특별히 제공하는 방식을 사용한 것이다. 

### 표준 출력의 리다이렉션

표준 출력도 리다이렉션할 수 있다. 자주 사용되는 패턴은 명령어의 실행 결과를 화면에 출력하는 것이 아니라 파일에 저장하는 것이다. 

표준 출력도 기호 `>` 를 사용한다. 

`ls -l / > list.txt` → 실행 결과가 화면에 출력되지 않고 지정한 파일에 저장되면 시간이 지난 뒤에도 결과를 다시 확인할 수 있다. 

### 표준 에러 출력

표준 에러 출력은 프로그램의 에러 메시지를 출력하기 위해 사용된다. 예를 들어 `ls` 명령어를 실행할 때 존재하지 않는 파일을 지정하면 에러 메시지가 출력된다. 

콘솔에 출력된 메시지가 표준 출력에 의해 출력된 건지, 표준 에러 출력에 의해 출력된 건지 판단하기 어렵다. 

하지만 표준 출력을 파일에 리다이렉션 해보면 차이를 알 수 있다. `ls /xxxxx > list.txt` 이렇게 하면 실행 결과는 단말 디스플레이에 출력되지 않는다. 에러 메시지가 화면에 출력된다. 

**이는 표준 출력과 표준 에러 출력이 별도의 채널을 사용하기 때문이다.** 

표준 출력을 파일에 리다이렉션했지만 표준 에러 출력은 별도로 리다이렉션하지 않아서 에러 메시지가 콘솔에 출력된 것이다. 

이때 표준 에러 출력도 파일에 리다이렉션할 수 있다. 이때는 `2>` 라는 기호를 사용해야 한다. 

`ls /xxxxx 2> error.txt`

이처럼 명령어의 실행 결과와 에러 메시지를 별도로 다루려고 표준 출력과 표준 에러 출력이 별도로 존재하는 것이다. 

`ls /xxxxx > list.txt 2>error.txt`

## 표준 출력과 표준 에러 출력을 함께 리다이렉션

표준 출력과 표준 에러 출력을 파일 하나에 리다이렉션할 때도 있을 것이다. 

**이때는 표준 출력을 리다이렉션한 뒤에 `2>&1` 을 붙여주면 된다.**

`ls /xxxxx > result.txt 2>&1`

위 명령어를 해석하면 먼저 `>` 를 통해 reulst.txt로 리다이렉션한다. 이어서 표준 에러 출력을 `&1` 으로 리다이렉션한다. 여기서 `&1` 은 표준 출력을 의미한다. (리눅스에서는 내부적으로 표준 입출력을 숫자로 관리하고 있다)

이렇게 되면 표준 출력과 표준 에러 출력을 동일한 파일에 저장할 수 있다. 

## 리다이렉션으로 파일 덮어쓰기

이미 존재하는 파일에 표준 출력을 리다이렉션하면 기존 파일을 지우고 덮어쓰게 된다. 

```bash
echo 123 > number.txt
cat number.txt
// 123
echo 456 > number.txt
cat number.txt
// 456
```

`>` 대신 `>>` 을 사용하면 덮어쓰지 않고 파일의 끝에 이어서 기록하게 된다. 

### /dev/null

리눅스를 다루다보면 `/dev/null` 이라는 파일에 리다이렉션할 때가 있다. 

`/dev/null` 은 특수 파일로서 다음 특성을 가진다.

1. 입력 파일로 지정해도 아무 내용도 입력되지 않는다.
2. 출력 파일로 지정해도 아무 내용도 기록되지 않는다. 

`cat < /dev/null` : 아무것도 표시되지 않음

표준 출력을 `/dev/null` 로 리다이렉션하면 표준 출력이 콘솔에 출력되지 않는다. 이때 표준 에러 출력만이 콘솔에 출력된다. 

`cat /etc/crontab > /dev/null`

표준 출력으로 출력되는 양이 너무 많거나 표준 에러 출력만 확인할 때 자주 사용하는 방법이다.

**에러 메시지 출력을 무시** : `ls / /xxxx 2> /dev/null`

## 파이프라인

여러 명령어를 연결하려면 한 명령어의 실행 결과를 다른 명령어에 입력할 수 있어야 한다. 이를 위해 존재하는 기능이 파이프라인이다. 

**파이프라인을 사용하면 명령어의 표준 출력을 다른 명령어의 표준 입력으로 연결할 수 있다.**

ls 명령어의 실행 결과가 너무 큰 경우에 리다이렉션한 뒤에 less 명령어로 해당 파일을 조회하는 것도 방법이다.

`ls -l / > temp_list.txt`

`less tmp_list.txt`

하지만 이렇게 매번 실행 결과를 파일에 담는 방법은 비효율적이므로 파이프라인을 사용하면 중간에 파일을 만들지 않고도 명령어의 실행 결과를 다른 명령어에 전달할 수 있다.

`<명령어 1> | <명령어2> ...`

그러면 첫 번째 명령어의 표준 출력이 두 번째 명령어의 표준 입력으로 전달된다. 

`ls -l | less`

`history | less`

파이프라인은 기본적으로 표준 출력만 다음 명령어에 연결한다. 표준 에러 출력도 함께 보내려면 표준 에러 출력을 표준 출려과 동일한 곳으로 리다이렉션해야 한다. 

ls 명령어의 표준 출력과 표준 에러 출력을 less 명령어로 전달하기

`ls -l / /xxxx 2>&1 | less`

## 필터 명령어

cat 명령어처럼 표준 입력을 받아들여 표준 출력으로 출력하는 명령어를 필터 명령어라 한다.

### head 명령어

head는 지정한 파일의 첫 행부터 지정한 행까지 출력한다. 이때 출력할 행 수를 지정하지 않으면 첫 10행을 출력한다. 

`head /etc/crontab`

`history | head`

### 대표적인 필터 명령어

`cat` : 입력 내용을 그대로 출력

`head` : 파일 앞부분을 출력

`tail` : 파일 뒷부분을 출력

`grep` : 검색 패턴에 일치하는 행을 출력

`sort` : 정렬

`uniq` : 중복된 행을 제거하여 출력

`tac` : 역순으로 출력

`wc` : 행 수나 바이트 수를 출력

### 명령어 조합

필터 명령어는 파이프라인을 사용하여 다른 명령어와 조합할 때 진가가 발휘된다.

ex> `/bin` 디렉터리에 있는 파일을 크기가 큰 순서대로 5개 출력하고 싶은 경우

→ 파일의 크기를 출력하는 명령어로는 `du` 가 있다. b옵션은 파일 크기를 바이트 단위로 출력한다. 

sort 명령어를 사용해서 결과를 정렬할 수 있다. sort 명령어를 사용할 때 아무 옵션도 지정하지 않으면 알파벳 순으로 정렬한다. 숫자를 기반으로 정렬하려면 -n 옵션을 추가해야 한다.

`du -b /bin/* | sort -n | tac | head -n 5`

### 리다이렉션 vs 파이프라인

리다이렉션은 해당 명령어의 입출력을 파일로 이동하거나 파일의 데이터를 가져오는 데 사용한다.

파이프라인은 여러 명령어를 조합하여 데이터의 흐름을 연결하는데 사용한다. 한 명령어의 출력이 다음 명령어의 입력으로 전달된다.