# 10.프로세스와 잡

## 프로세스란?

명령어의 실체는 디스크에 있는 파일들이다. 셸에서 명령어를 입력하면 커널이 해당 파일을 읽어서 메모리에 올린 뒤 CPU가 프로그램을 실행한다. 여기서 메모리 위에 올린 프로그램을 프로세스라 한다.

같은 프로그램을 실행하더라도 각 프로세스는 별도의 메모리 영역을 가진다. 

예를 들어 `ls` 명령어를 동시에 여러 번 실행해도 각 프로세스가 내부적으로 사용하는 데이터가 섞일 일은 없다. 

그리고 파일 소유자 외에는 해당 파일에 대한 조작 권한이 제한되는 것과 비슷하게 프로세스를 실행한 사용자 외에는 해당 프로세스를 조작할 수 있는 권한이 제한된다. 

리눅스 커널은 각 프로세스에게 프로세스 ID라는 고유한 번호를 할당해서 관리한다. 프로세스를 관리하는 것은 리눅스 커널의 중요한 기능 중 하나이다. 

그리고 리눅스에서 새로운 프로세스는 이미 기존에 존재하는 별도의 프로세스를 기반으로 만들어진다. 여기서 새로운 프로세스를 만드는 프로세스를 부모 프로세스라고 하며, 새롭게 만들어지는 프로세스를 자식 프로세스라고 한다. 예를 들어 셸에서 ls 명령어를 실행하면 셸이 부모 프로세스이며, ls 명령어는 자식 프로세스가 된다. 

## ps 명령어 : 프로세스 목록 표시

ps 명령어는 현재 시스템에서 실행 중인 프로세스의 목록을 출력한다. 아무런 인자 없이 ps를 실행하면 현재 접속한 터미널에서 실행한 프로세스만을 출력한다. 

`ps` 명령어를 실행했을 때 나오는 결과로, PID는 프로세스 ID를 의미하고, CMD는 실행한 명령어를 의미한다.

프로세스 ID는 프로세스를 종료하기 전까지 바뀌지 않는다. 따라서, 특정 프로세스를 지정할 때 프로세스 ID를 사용한다. 

### 현재 접속한 터미널 이외의 프로세스를 출력하고 싶은 경우

다른 터미널에서 실행 중인 프로세스나 터미널과 무관하게 돌아가는 프로세스인 데몬(daemon)을 출력하려면 

x옵션을 사용한다. 그러면 사용자가 현재 실행 중인 모든 프로세스를 확인할 수 있다. 

`ps xf`

## 잡

프로세스는 리눅스 커널의 입장에서 바라본 처리 단위이다. 한편 셸에서 바라본 처리 단위를 잡(job)이라고 한다.

셸의 커맨드 라인에 입력한 한 행이 곧 잡에 해당한다.

커맨드 라인에서 명령어 하나만을 입력했다면 프로세스와 잡이 같다. 복수의 명령어를 파이프로 연결했다면 프로세스는 명령어마다 만들어지지만 잡은 하나만 만들어진다. 

`ls -l | cat -n | less` : 프로세스는 3개이지만 job은 1개

### 명령어를 일시 정지하는 법

`Ctrl + z` : 종료된 것이 아니라 일시 정지하는 것이다. 

### fg 명령어 : 잡을 포그라운드로 전환

사용자의 입력을 받아들일 수 있는 job의 상태를 포그라운드라고 한다. 정지 상태에 있는 것을 다시 확인하기 위해서는 포그라운드로 되돌려야 한다.

잡을 포그라운드로 전환하려면 fg 명령어를 사용한다.

`fg %<잡 번호>`

fg 명령어를 사용할 때 잡 번호를 생략하면 현재 잡이 포그라운드가 된다. 정지한 잡이 한 개 뿐이라면 굳이 잡 번호를 지정하지 않아도 해당 잡이 포그라운드가 된다.

### bg 명령어 : 잡을 백그라운드로 전환

Ctrl + z 로 잡을 정지하면 해당 잡이 동작을 멈춘다. 포그라운드와 반대로 사용자가 조작할 수 없는 잡의 상태를 백그라운드라고 한다. 

`bg %<잡 번호>`

처음부터 잡을 백그라운드에서 실행할 수도 있다. 커맨드 라인의 마지막에 `&` 을 추가하면 된다.

`cp file1 file2 &`

### 잡의 상태 전이

![image](https://github.com/Jake-huen/reading_books_record_repository/assets/57055730/8aaccf27-a840-4e08-8dfe-6d498268704c)


포그라운드 : 사용자가 조작하면서 실행 중인 상태

백그라운드 : 사용자가 조작할 수 없지만 실행 중인 상태

정지 : 처리를 일시적으로 중단한 상태

## 잡과 프로세스의 종료

### 잡 종료

포그라운드로 실행 중인 잡을 종료하기 위해서는 Ctrl + c 를 입력하면 된다.

백그라운드로 실행 중인 잡을 종료하기 위해서는 `kill` 명령어를 사용해야 한다.

### 프로세스 종료

프로세스를 종료할 때도 백그라운드 잡과 마찬가지로 kill 명령어를 사용한다.

`kill <프로세스ID>`

### kill 명령어

kill 명령어는 사실 잡이나 프로세스를 종료하는 명령어가 아니라 시그널을 전송하는 명령어이다. 

시그널이란 말 그대로 프로세스에게 전송되는 신호이다. 프로세스는 전달받은 시그널에 따라 종료, 정지, 재기동 등의 처리를 수행한다. 

![image](https://github.com/Jake-huen/reading_books_record_repository/assets/57055730/4eb22c38-b308-4f68-adda-33c9dc5496a3)


여기서 9) SIGKILL은 프로세스에 전달되지 않고 리눅스 커널이 직접 처리한다. 리눅스 커널은 이 시그널을 받으면 지정한 프로세스를 강제로 종료한다. 

SIGKILL은 마지막 수단으로 생각해야 한다.
